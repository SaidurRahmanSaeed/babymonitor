<!-- web/templates/index.html -->
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Baby Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { display: flex; gap: 20px; }
        .panel { border: 1px solid #ccc; padding: 10px; border-radius: 6px; }
        button { margin: 4px; padding: 6px 10px; }
        #status { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Baby Monitor</h1>

    <div class="container">
        <div class="panel">
            <h2>Camera</h2>
            <img src="{{ url_for('video_feed') }}" width="640" height="480">
        </div>

        <div class="panel">
            <h2>Lullaby Control</h2>
            <button onclick="playLullaby('lullaby1')">Play Lullaby 1</button><br>
            <button onclick="playLullaby('whitenoise')">Play White Noise</button><br>
            <button onclick="stopLullaby()">Stop</button>

            <h2>Status</h2>
            <div id="status">
                Loading...
            </div>
        </div>
    </div>

    <script>
        function playLullaby(name) {
            fetch(`/api/lullaby/${name}`, {method: 'POST'})
                .then(r => r.json())
                .then(data => console.log("lullaby response", data));
        }

        function stopLullaby() {
            fetch(`/api/lullaby/stop`, {method: 'POST'})
                .then(r => r.json())
                .then(data => console.log("stop response", data));
        }

        function refreshStatus() {
            fetch(`/api/status`)
                .then(r => r.json())
                .then(data => {
                    const el = document.getElementById("status");
                    const last = data.last_cry_time || "No cries detected yet";
                    el.innerHTML = `
                        <p>Last cry time: ${last}</p>
                        <p>Total cry events: ${data.cry_count}</p>
                    `;
                })
                .catch(err => console.error(err));
        }

        setInterval(refreshStatus, 3000);
        refreshStatus();
    </script>
</body>
</html>
